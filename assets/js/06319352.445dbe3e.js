"use strict";(self.webpackChunksaurus=self.webpackChunksaurus||[]).push([[8101],{8496:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>a,frontMatter:()=>r,metadata:()=>o,toc:()=>c});var t=i(5893),s=i(1151);const r={},l="bootc-image-builder",o={id:"bootc/index",title:"bootc-image-builder",description:"A container for deploying bootable container images.",source:"@site/docs/bootc/index.md",sourceDirName:"bootc",slug:"/bootc/",permalink:"/docs/bootc/",draft:!1,unlisted:!1,editUrl:"https://github.com/osbuild/saurus/tree/main/docs/bootc/index.md",tags:[],version:"current",frontMatter:{},sidebar:"bootc"},d={},c=[{value:"\ud83d\udd28 Installation",id:"-installation",level:2},{value:"\ud83d\ude80 Examples",id:"-examples",level:2},{value:"Running the resulting QCOW2 file on Linux (x86_64)",id:"running-the-resulting-qcow2-file-on-linux-x86_64",level:3},{value:"Running the resulting QCOW2 file on macOS (aarch64)",id:"running-the-resulting-qcow2-file-on-macos-aarch64",level:3},{value:"\ud83d\udcdd Arguments",id:"-arguments",level:2},{value:"Detailed description of positional flags",id:"detailed-description-of-positional-flags",level:3},{value:"\ud83d\udcbe Image types",id:"-image-types",level:2},{value:"\ud83d\udcbd Volumes",id:"-volumes",level:2},{value:"\ud83d\udcdd Build config",id:"-build-config",level:2},{value:"Users (<code>user</code>, array)",id:"users-user-array",level:3},{value:"\ud83d\udcca Project",id:"-project",level:2},{value:"Contributing",id:"contributing",level:3},{value:"\ud83d\uddc4\ufe0f Repository",id:"\ufe0f-repository",level:2},{value:"\ud83e\uddfe License",id:"-license",level:2}];function h(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"bootc-image-builder",children:"bootc-image-builder"}),"\n",(0,t.jsx)(n.p,{children:"A container for deploying bootable container images."}),"\n",(0,t.jsx)(n.h2,{id:"-installation",children:"\ud83d\udd28 Installation"}),"\n",(0,t.jsxs)(n.p,{children:["Have ",(0,t.jsx)(n.a,{href:"https://podman.io/",children:"podman"})," installed on your system. Either through your systems package manager if you're on\nLinux or through ",(0,t.jsx)(n.a,{href:"https://podman.io/",children:"Podman Desktop"})," if you are on Mac OS or Windows. If you want to run the resulting\nvirtual machine(s) or installer media you can use ",(0,t.jsx)(n.a,{href:"https://www.qemu.org/",children:"qemu"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"On macOS, the podman machine must be running in rootful mode:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'$ podman machine stop   # if already running\nWaiting for VM to exit...\nMachine "podman-machine-default" stopped successfully\n$ podman machine set --rootful\n$ podman machine start\n'})}),"\n",(0,t.jsx)(n.h2,{id:"-examples",children:"\ud83d\ude80 Examples"}),"\n",(0,t.jsxs)(n.p,{children:["The following example builds a ",(0,t.jsx)(n.a,{href:"https://docs.fedoraproject.org/en-US/eln/",children:"Fedora ELN"})," bootable container into a QCOW2 image for the architecture you're running\nthe command on."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"mkdir output\nsudo podman run \\\n    --rm \\\n    -it \\\n    --privileged \\\n    --pull=newer \\\n    --security-opt label=type:unconfined_t \\\n    -v $(pwd)/output:/output \\\n    quay.io/centos-bootc/bootc-image-builder:latest \\\n    --type qcow2 \\\n    quay.io/centos-bootc/fedora-bootc:eln\n"})}),"\n",(0,t.jsx)(n.h3,{id:"running-the-resulting-qcow2-file-on-linux-x86_64",children:"Running the resulting QCOW2 file on Linux (x86_64)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"qemu-system-x86_64 \\\n    -M accel=kvm \\\n    -cpu host \\\n    -smp 2 \\\n    -m 4096 \\\n    -bios /usr/share/OVMF/OVMF_CODE.fd \\\n    -serial stdio \\\n    -snapshot output/qcow2/disk.qcow2\n"})}),"\n",(0,t.jsx)(n.h3,{id:"running-the-resulting-qcow2-file-on-macos-aarch64",children:"Running the resulting QCOW2 file on macOS (aarch64)"}),"\n",(0,t.jsxs)(n.p,{children:["This assumes qemu was installed through ",(0,t.jsx)(n.a,{href:"https://brew.sh/",children:"homebrew"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"qemu-system-aarch64 \\\n    -M accel=hvf \\\n    -cpu host \\\n    -smp 2 \\\n    -m 4096 \\\n    -bios /opt/homebrew/Cellar/qemu/8.1.3_2/share/qemu/edk2-aarch64-code.fd \\\n    -serial stdio \\\n    -machine virt \\\n    -snapshot output/qcow2/disk.qcow2\n"})}),"\n",(0,t.jsx)(n.h2,{id:"-arguments",children:"\ud83d\udcdd Arguments"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'Usage:\n  sudo podman run \\\n    --rm \\\n    -it \\\n    --privileged \\\n    --pull=newer \\\n    --security-opt label=type:unconfined_t \\\n    -v $(pwd)/output:/output \\\n    quay.io/centos-bootc/bootc-image-builder:latest \\\n    <imgref>\n\nFlags:\n      --config string   build config file\n      --tls-verify      require HTTPS and verify certificates when contacting registries (default true)\n      --type string     image type to build [qcow2, ami] (default "qcow2")\n'})}),"\n",(0,t.jsx)(n.h3,{id:"detailed-description-of-positional-flags",children:"Detailed description of positional flags"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Argument"}),(0,t.jsx)(n.th,{children:"Description"}),(0,t.jsx)(n.th,{style:{textAlign:"center"},children:"Default Value"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"--config"})}),(0,t.jsxs)(n.td,{children:["Path to a ",(0,t.jsx)(n.a,{href:"#-build-config",children:"build config"})]}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"\u274c"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"--tls-verify"}),(0,t.jsx)(n.td,{children:"Require HTTPS and verify certificates when contacting registries"}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:(0,t.jsx)(n.code,{children:"true"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"--type"})}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.a,{href:"#-image-types",children:"Image type"})," to build"]}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:(0,t.jsx)(n.code,{children:"qcow2"})})]})]})]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsxs)(n.em,{children:["\ud83d\udca1 Tip: Flags in ",(0,t.jsx)(n.strong,{children:"bold"})," are the most important ones."]})}),"\n",(0,t.jsx)(n.h2,{id:"-image-types",children:"\ud83d\udcbe Image types"}),"\n",(0,t.jsxs)(n.p,{children:["The following image types are currently available via the ",(0,t.jsx)(n.code,{children:"--type"})," argument:"]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Image type"}),(0,t.jsx)(n.th,{children:"Target environment"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"ami"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/AMIs.html",children:"Amazon Machine Image"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"qcow2"})," ",(0,t.jsx)(n.strong,{children:"(default)"})]}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"https://www.qemu.org/",children:"QEMU"})})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"-volumes",children:"\ud83d\udcbd Volumes"}),"\n",(0,t.jsx)(n.p,{children:"The following volumes can be mounted inside the container:"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Volume"}),(0,t.jsx)(n.th,{children:"Purpose"}),(0,t.jsx)(n.th,{style:{textAlign:"center"},children:"Required"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"/output"})}),(0,t.jsx)(n.td,{children:"Used for storing the resulting artifacts"}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"\u2705"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"/store"})}),(0,t.jsxs)(n.td,{children:["Used for the ",(0,t.jsx)(n.a,{href:"https://www.osbuild.org/",children:"osbuild store"})]}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"No"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"/rpmmd"})}),(0,t.jsx)(n.td,{children:"Used for the DNF cache"}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"No"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"-build-config",children:"\ud83d\udcdd Build config"}),"\n",(0,t.jsxs)(n.p,{children:["A build config is a JSON file with customizations for the resulting image. A path to the file is passed via  the ",(0,t.jsx)(n.code,{children:"--config"})," argument. The customizations are specified under a ",(0,t.jsx)(n.code,{children:"blueprint.customizations"})," object."]}),"\n",(0,t.jsx)(n.p,{children:"As an example, let's show how you can add a user to the image:"}),"\n",(0,t.jsxs)(n.p,{children:["Firstly create a file ",(0,t.jsx)(n.code,{children:"output/config.json"})," and put the following content into it:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "blueprint": {\n    "customizations": {\n      "user": [\n        {\n          "name": "foo",\n          "password": "bar",\n          "groups": [\n            "wheel"\n          ]\n        }\n      ]\n    }\n  }\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Then, run ",(0,t.jsx)(n.code,{children:"bootc-image-builder"})," with the following arguments:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"sudo podman run \\\n    --rm \\\n    -it \\\n    --privileged \\\n    --pull=newer \\\n    --security-opt label=type:unconfined_t \\\n    -v $(pwd)/output:/output \\\n    quay.io/centos-bootc/bootc-image-builder:latest \\\n    --type qcow2 \\\n    --config /output/config.json \\\n    quay.io/centos-bootc/fedora-bootc:eln\n"})}),"\n",(0,t.jsxs)(n.h3,{id:"users-user-array",children:["Users (",(0,t.jsx)(n.code,{children:"user"}),", array)"]}),"\n",(0,t.jsx)(n.p,{children:"Possible fields:"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Field"}),(0,t.jsx)(n.th,{children:"Use"}),(0,t.jsx)(n.th,{style:{textAlign:"center"},children:"Required"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"name"})}),(0,t.jsx)(n.td,{children:"Name of the user"}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"\u2705"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"password"})}),(0,t.jsx)(n.td,{children:"Unencrypted password"}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"No"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"groups"})}),(0,t.jsx)(n.td,{children:"An array of secondary to put the user into"}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"No"})]})]})]}),"\n",(0,t.jsx)(n.p,{children:"Example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "user": [\n    {\n      "name": "alice",\n      "password": "bob",\n      "groups": [\n        "wheel",\n        "admins"\n      ]\n    }\n  ]\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"-project",children:"\ud83d\udcca Project"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Website"}),": ",(0,t.jsx)(n.a,{href:"https://www.osbuild.org",children:"https://www.osbuild.org"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Bug Tracker"}),": ",(0,t.jsx)(n.a,{href:"https://github.com/osbuild/bootc-image-builder/issues",children:"https://github.com/osbuild/bootc-image-builder/issues"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Matrix"}),": #image-builder on ",(0,t.jsx)(n.a,{href:"https://matrix.to/#/#image-builder:fedoraproject.org",children:"fedoraproject.org"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Mailing List"}),": ",(0,t.jsx)(n.a,{href:"mailto:image-builder@redhat.com",children:"image-builder@redhat.com"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Changelog"}),": ",(0,t.jsx)(n.a,{href:"https://github.com/osbuild/bootc-image-builder/releases",children:"https://github.com/osbuild/bootc-image-builder/releases"})]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"contributing",children:"Contributing"}),"\n",(0,t.jsxs)(n.p,{children:["Please refer to the ",(0,t.jsx)(n.a,{href:"../developer-guide/index",children:"developer guide"})," to learn about our\nworkflow, code style and more."]}),"\n",(0,t.jsx)(n.h2,{id:"\ufe0f-repository",children:"\ud83d\uddc4\ufe0f Repository"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"web"}),":   ",(0,t.jsx)(n.a,{href:"https://github.com/osbuild/bootc-image-builder",children:"https://github.com/osbuild/bootc-image-builder"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"https"}),": ",(0,t.jsx)(n.code,{children:"https://github.com/osbuild/bootc-image-builder.git"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"ssh"}),":   ",(0,t.jsx)(n.code,{children:"git@github.com:osbuild/bootc-image-builder.git"})]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"-license",children:"\ud83e\uddfe License"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.strong,{children:"Apache-2.0"})}),"\n",(0,t.jsx)(n.li,{children:"See LICENSE file for details."}),"\n"]})]})}function a(e={}){const{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},1151:(e,n,i)=>{i.d(n,{Z:()=>o,a:()=>l});var t=i(7294);const s={},r=t.createContext(s);function l(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);